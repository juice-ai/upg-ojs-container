# File: docker-compose.override.yml
# Author: Marc Bria UAB (marc.bria@uab.es)

services:
  app:
    # When running behind Traefik, the app container should not publish its ports directly.
    # Traefik handles external traffic on ports 80 and 443 and routes it to the app container
    # over the internal 'proxy' network. We override the ports section with an empty list.
    ports: []
    labels:
      # Enable Traefik for this service.
      - "traefik.enable=true"
      # Explicitly tell Traefik to use the 'proxy' network to communicate with this service.
      # This is necessary because the 'app' container is attached to multiple networks.
      - "traefik.docker.network=proxy"
      # Define a service named 'ojs-app' that our file-based router can reference.
      # The router will use 'ojs-app@docker' to find this service.
      # The port must match the internal port of the container (Apache is on 80).
      - "traefik.http.services.ojs-app.loadbalancer.server.port=80"

    networks:
      - proxy

networks:
  proxy:
    external: true
